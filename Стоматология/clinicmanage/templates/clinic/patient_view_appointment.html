{% extends 'clinic/base.html' %}

{% block content %}
<!-- –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ -->
<section class="services" style="padding: 5rem 0; background: #f8f9fa;">
  <div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <h2 class="section-title text-center mb-5" style="color: #0d98ba; font-family: 'Arial', sans-serif;">
      –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤
    </h2>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∏—ë–º–æ–≤ -->
    {% if appointments %}
    <div class="service-card">
      <div class="service-body">
        <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
          <thead style="background-color: #d1f1ff; color: #007bff;">
          <tr>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–í—Ä–∞—á</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–ñ–∞–ª–æ–±—ã</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–°—Ç–∞—Ç—É—Å</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—Ä–∞—á–∞</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–§–∞–π–ª—ã</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
          </thead>
          <tbody>
          {% for app in appointments %}
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px; border: 1px solid #ddd;">{{ app.appointment_date|date:"d.m.Y H:i" }}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ app.dentist.get_full_name }}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ app.description|default:"‚Äî" }}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">
              {% if app.appointment_date > now %}
              <span style="background: #28a745; color: white; padding: 5px 10px; border-radius: 50px; font-size: 1.3rem;">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</span>
              {% elif app.is_attended == True %}
              <span style="background: #007bff; color: white; padding: 5px 10px; border-radius: 50px; font-size: 1.3rem;">–ü—Ä–∏—à—ë–ª</span>
              {% elif app.is_attended == False %}
              <span style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 50px; font-size: 1.3rem;">–ù–µ –ø—Ä–∏—à—ë–ª</span>
              {% else %}
              <span style="background: #6c757d; color: white; padding: 5px 10px; border-radius: 50px; font-size: 1.3rem;">–ó–∞–≤–µ—Ä—à—ë–Ω</span>
              {% endif %}
            </td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ app.comment|default:"‚Äî" }}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">
              {% if app.documents.all %}
              {% for doc in app.documents.all %}
              <div class="mb-1">
                <a href="{{ doc.file.url }}" target="_blank" style="color: #007bff; text-decoration: none;">
                  {% if doc.file.url|slice:"-4:" in ".jpg,.jpeg,.png,.gif" %}
                  üñº
                  {% elif doc.file.url|slice:"-4:" == ".pdf" %}
                  üìÑ
                  {% else %}
                  üìé
                  {% endif %}
                </a>
              </div>
              {% endfor %}
              {% else %}
              ‚Äî
              {% endif %}
            </td>
            <td style="padding: 10px; border: 1px solid #ddd;">
              {% if app.appointment_date > now %}
              <form method="post" action="{% url 'cancel-appointment' app.id %}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?');">
                {% csrf_token %}
                <button type="submit" style="background: #dc3545; color: white; padding: 6px 12px; border: none; border-radius: 6px; font-size: 1.3rem; cursor: pointer;">
                  –û—Ç–º–µ–Ω–∏—Ç—å
                </button>
              </form>
              {% else %}
              ‚Äî
              {% endif %}
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% else %}
    <div class="text-center">
      <p class="text-muted" style="font-size: 1.6rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –ø—Ä–∏—ë–º.</p>
    </div>
    {% endif %}

    <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º"-->
    <div class="container text-center my-5" style="margin-top: 3rem !important;">
      <a href="{% url 'patient-book-appointment' %}" class="hero-btn primary" style="display: inline-block; padding: 1rem 2.5rem; background: #28a745; color: white; text-decoration: none; border-radius: 50px; font-weight: 900; font-size: 1.5rem; transition: all 0.3s ease;">
        –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º
      </a>
    </div>
  </div>
</section>
{% endblock %}